# éƒ¨ç½²æ–‡æ¡£

## å‰è¨€

### ç›®çš„

æœ¬æ–‡æ¡£ä¸»è¦ç”¨äºæŒ‡å¯¼å®æ–½äººå‘˜å¯¹ç”¨æˆ·ç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²ä»¥åŠå’Œç³»ç»Ÿè¿ç»´äººå‘˜è¿›è¡Œç³»ç»Ÿè¿ç»´è¿›è¡Œå‚è€ƒã€‚æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†æè¿°äº†ç³»ç»Ÿéƒ¨ç½²çš„ç¯å¢ƒè¦æ±‚ã€è¿‡ç¨‹æ­¥éª¤ã€‚

 

### æœ¯è¯­ä¸ç¼©ç•¥è¯­

| **åºå·** | **æœ¯è¯­ã€ç¼©å†™**  | **è§£** **é‡Š**                                       |
| -------- | --------------- | --------------------------------------------------- |
| 1        | æ˜“è¨€- YiYan_LAL | æ˜“è¨€ç”Ÿæ´»å­¦ä¹ å¹³å°-YiYan_Learning_And_Living_Platform |
| 2        |                 |                                                     |
| 3        |                 |                                                     |



## éƒ¨ç½²ç¯å¢ƒ

æœ¬é¡¹ç›®ä½¿ç”¨çš„éƒ¨ç½²ç¯å¢ƒæè¿°å¦‚ä¸‹ï¼š

### äº‘æœåŠ¡å™¨ECS

æœ¬é¡¹ç›®é‡‡ç”¨é˜¿é‡Œäº‘ ECS äº‘æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š

| åç§°     | é…ç½®                                            |
| -------- | ----------------------------------------------- |
| CPU&å†…å­˜ | 2æ ¸(vCPU)2 GiB                                  |
| æ“ä½œç³»ç»Ÿ | Alibaba Cloud Linux 3.2104 LTS 64ä½ï¼ˆCentOS 7ï¼‰ |
| å…¬ç½‘IP   | 8.130.11.33                                     |

æˆ‘ä»¬é€‰æ‹©äº‘æœåŠ¡å™¨ï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. å¼¹æ€§å’Œå¯ä¼¸ç¼©æ€§ï¼šäº‘æœåŠ¡å™¨å…è®¸æ ¹æ®éœ€æ±‚å¿«é€Ÿè°ƒæ•´è®¡ç®—èµ„æºï¼Œå¯ä»¥æ ¹æ®æµé‡å’Œéœ€æ±‚çš„å˜åŒ–è¿›è¡Œæ‰©å±•æˆ–ç¼©å‡ã€‚è¿™ç§å¼¹æ€§ä½¿æ‚¨èƒ½å¤Ÿçµæ´»åœ°é€‚åº”æµé‡é«˜å³°æˆ–ä½è°·ï¼Œé¿å…èµ„æºæµªè´¹æˆ–æ€§èƒ½é—®é¢˜ã€‚
2. é«˜å¯ç”¨æ€§ï¼šäº‘æœåŠ¡å™¨é€šå¸¸éƒ¨ç½²åœ¨å¤šä¸ªç‰©ç†æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡å†—ä½™å’Œè´Ÿè½½å‡è¡¡æ¥æä¾›é«˜å¯ç”¨æ€§ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼ŒæœåŠ¡å°†è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–å¯ç”¨çš„æœåŠ¡å™¨ä¸Šï¼Œç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºæŒç»­å¯ç”¨ã€‚
3. ç®¡ç†å’Œç»´æŠ¤çš„ç®€åŒ–ï¼šäº‘æœåŠ¡æä¾›å•†è´Ÿè´£ç¡¬ä»¶å’ŒåŸºç¡€è®¾æ–½çš„ç®¡ç†å’Œç»´æŠ¤ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨çš„æ›´æ–°ã€å®‰å…¨è¡¥ä¸å’Œæ•…éšœæ’é™¤ç­‰å·¥ä½œã€‚è¿™ä½¿æ‚¨å¯ä»¥å°†æ›´å¤šç²¾åŠ›é›†ä¸­åœ¨åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ä¸Šï¼Œè€Œæ— éœ€è¿‡å¤šå…³æ³¨åº•å±‚åŸºç¡€è®¾æ–½çš„ç®¡ç†å·¥ä½œã€‚



### ç½‘ç»œç¯å¢ƒ

æœ¬é¡¹ç›®å¯¹äºç½‘ç»œé€šä¿¡è¿‡ç¨‹æ— ç‰¹æ®Šè¦æ±‚ï¼Œ**å¿…è¦**æš´éœ²ç«¯å£å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| ç«¯å£ | è§£é‡Š                  |
| ---- | --------------------- |
| 80   | Nginx WebæœåŠ¡ä½¿ç”¨ç«¯å£ |
| 8080 | åç«¯æœåŠ¡ç«¯å£          |

è€ƒè™‘åˆ°ç”¨æˆ·éœ€æ±‚å’Œå®ç°é—®é¢˜ä¸åŒï¼Œå…¶ä½™ç«¯å£å¯èƒ½éœ€è¦æš´éœ²å¦‚ä¸‹ï¼š

| ç«¯å£ | è§£é‡Š                    |
| ---- | ----------------------- |
| 3306 | MySQLä½¿ç”¨ç«¯å£           |
| 22   | é˜¿é‡Œäº‘æœåŠ¡å™¨SSHæ¥å…¥ç«¯å£ |

è‹¥ç”¨æˆ·åœ¨æœ¬åœ°è¿è¡Œï¼Œå…·ä½“ä½¿ç”¨ç«¯å£ä¾æ®è½¯ä»¶å®ç°å®šä¹‰ï¼Œç”¨æˆ·å¯è‡ªè¡Œå†³å®šï¼Œä¾‹å¦‚ Vite æ„å»ºé¡¹ç›®æ—¶ä¼šä½¿ç”¨ æœ¬åœ°çš„`5173`æ¥å£ã€‚è¯·æ ¹æ®è‡ªèº«æƒ…å†µä¸é˜²ç«å¢™è®¾ç½®åˆ†é…åˆé€‚çš„ç«¯å£è¿›è¡Œè°ƒè¯•ï¼Œä¸€èˆ¬æ¥è¯´ä½¿ç”¨é»˜è®¤ç«¯å£å³å¯ã€‚



#### ECS å®‰å…¨ç»„é…ç½®

æœ¬é¡¹ç›®ä½¿ç”¨çš„é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨éœ€è¦é…ç½®å®‰å…¨ç»„å®ç°ç«¯å£çš„æš´éœ²è®¿é—®ã€‚

![](.\img\1.png)

è‹¥ä½¿ç”¨é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œè¯·åœ¨è¯¥é¡µé¢é…ç½®å®‰å…¨ç»„å¹¶å°†æœåŠ¡å™¨å®ä¾‹åŠ å…¥è®¾å®šçš„å®‰å…¨ç»„ã€‚äº‘æœåŠ¡å™¨å®‰å…¨ç»„è®¾ç½®å¦‚ä¸‹ï¼š

| ç«¯å£èŒƒå›´  | æˆæƒå¯¹è±¡     | æè¿°                 |
| --------- | ------------ | -------------------- |
| 80/80     | æº:0.0.0.0/0 | Webæš´éœ²ç«¯å£          |
| 8080/8080 | æº:0.0.0.0/0 | åç«¯æš´éœ²ç«¯å£         |
| 3306/3306 | æº:0.0.0.0/0 | MySQL                |
| 3389/3389 | æº:0.0.0.0/0 | System created rule. |
| 22/22     | æº:0.0.0.0/0 | System created rule. |
| -1/-1     | æº:0.0.0.0/0 | System created rule. |



### å¯¹è±¡å­˜å‚¨ OSS

æœ¬é¡¹ç›®é‡‡ç”¨é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ OSS è¿›è¡Œä¸Šä¼ æ–‡ä»¶å’Œå›¾ç‰‡èµ„æºçš„ç®¡ç†å’Œå‚¨å­˜ã€‚è®¾ç½® Bucket çº§åˆ«çš„æƒé™è®¿é—®æ§åˆ¶ä¸ºå…¬å…±è¯»ï¼ˆpublic-readï¼‰å¯¹æ–‡ä»¶å†™æ“ä½œéœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¯ä»¥å¯¹æ–‡ä»¶è¿›è¡ŒåŒ¿åè¯»ã€‚æ–‡ä»¶å’Œå›¾ç‰‡çš„å…·ä½“è¯»å†™ç”±åç«¯æœåŠ¡å™¨è¿›è¡Œè¯·æ±‚å’Œå¤„ç†ã€‚



### äº‘æ•°æ®åº“

æœ¬é¡¹ç›®é‡‡ç”¨çš„æ˜¯è…¾è®¯äº‘æ•°æ®åº“ TencentDBï¼Œé‡‡ç”¨å…³ç³»å‹æ•°æ®åº“ MySQLï¼Œé…ç½®å¦‚ä¸‹ï¼š

| é…ç½®                                 | ç½‘ç»œ                                                         | æ•°æ®åº“ç‰ˆæœ¬ | å¼•æ“   |
| ------------------------------------ | ------------------------------------------------------------ | ---------- | ------ |
| åŒèŠ‚ç‚¹(æœ¬åœ°ç›˜) é€šç”¨å‹-1æ ¸1000MB/25GB | ç½‘ç»œï¼š[Default-VPC](https://console.cloud.tencent.com/vpc/vpc/detail?rid=8&id=vpc-ch40q4lo) - [Default-Subnet](https://console.cloud.tencent.com/vpc/subnet/detail?rid=8&id=subnet-45sdz3pz) | MySQL8.0   | InnoDB |

![](.\img\2.png)

æˆ‘ä»¬é€‰æ‹©äº‘æœåŠ¡å™¨ï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. å¯æ‰©å±•æ€§ï¼šäº‘æ•°æ®åº“å…è®¸æ ¹æ®éœ€æ±‚å¿«é€Ÿæ‰©å±•å­˜å‚¨å®¹é‡å’Œè®¡ç®—èµ„æºã€‚æ‚¨å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚å¢åŠ æˆ–å‡å°‘æ•°æ®åº“çš„è§„æ¨¡ï¼Œè€Œæ— éœ€æ‹…å¿ƒç¡¬ä»¶é™åˆ¶æˆ–æ€§èƒ½é—®é¢˜ã€‚
2. é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ï¼šäº‘æ•°æ®åº“é€šå¸¸é‡‡ç”¨å¤šä¸ªæ•°æ®ä¸­å¿ƒå’Œå¤åˆ¶æœºåˆ¶æ¥æä¾›é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚æ•°æ®åœ¨å¤šä¸ªåœ°ç†ä½ç½®è¿›è¡Œå¤åˆ¶ï¼Œç¡®ä¿åœ¨ä¸€ä¸ªæ•°æ®ä¸­å¿ƒå‘ç”Ÿæ•…éšœæ—¶ä»ç„¶å¯ç”¨ï¼Œå¹¶ä¿æŠ¤æ•°æ®å…å—æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚
3. è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤ï¼šäº‘æ•°æ®åº“æä¾›è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ï¼Œä½¿æ‚¨å¯ä»¥è½»æ¾åœ°åˆ›å»ºæ•°æ®åº“å¤‡ä»½ï¼Œå¹¶åœ¨éœ€è¦æ—¶å¿«é€Ÿæ¢å¤æ•°æ®ã€‚è¿™æä¾›äº†æ•°æ®çš„æŒä¹…æ€§å’Œå¯é æ€§ï¼Œä»¥åŠå¯¹æ„å¤–æ•°æ®ä¸¢å¤±çš„ä¿æŠ¤ã€‚



### AIå†…å®¹å®¡æ ¸

æœ¬é¡¹ç›®é‡‡ç”¨ç™¾åº¦æ™ºèƒ½äº‘AIå†…å®¹å®¡æ ¸å¹³å°ï¼Œå®ç°å¯¹ç½‘ç«™å†…å®¹çš„è‡ªåŠ¨åŒ–å®¡æ ¸ã€‚å…·ä½“é…ç½®å¯å‚è€ƒï¼š

[å¿«é€Ÿå…¥é—¨ - å†…å®¹å®¡æ ¸å¹³å° | ç™¾åº¦æ™ºèƒ½äº‘æ–‡æ¡£ (baidu.com)](https://cloud.baidu.com/doc/ANTIPORN/s/Wkhu9d5iy)

å®¡æ ¸ç­–ç•¥ä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼Œè·å–AccessTokenåé‡‡å–åç«¯ç»Ÿä¸€ API è°ƒç”¨ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é‡‡ç”¨è®¾ç½®åº”ç”¨çš„ API Keyå’Œ Secret Key æ¥è°ƒç”¨ç™¾åº¦ç›¸å…³æœåŠ¡ã€‚



- *æœ¬é¡¹ç›®ä¸»è¦é‡‡ç”¨**äº‘ç«¯éƒ¨ç½²**æ–¹å¼ï¼Œä¸ºèŠ‚çº¦æ—¶é—´å¯ä»¥ç›´æ¥æŸ¥çœ‹ç›¸å…³ç« èŠ‚ï¼Œå…¬ç½‘IPï¼š8.130.11.33ï¼›å…¶ä½™æ–¹å¼ä¸ä¸ºä¸»è¦éƒ¨ç½²æ–¹å¼ã€‚*

## å‰ç«¯å®‰è£…éƒ¨ç½²æŒ‡å—

æ˜“è¨€å­¦ä¹ ç”Ÿæ´»å¹³å°ç”¨äºå­¦ç”Ÿçš„å­¦ä¹ èµ„æºå…±äº«å’Œç”Ÿæ´»äº¤æµï¼Œé‡‡ç”¨`vue3`æ¡†æ¶å®ç°ã€‚æœ¬æ–‡ä»¶æä¾›æœ¬åœ°éƒ¨ç½²å’Œè¿œç¨‹éƒ¨ç½²æ–¹å¼ï¼Œä»¥ä¸‹ä¸ºè¯¦ç»†ä¿¡æ¯ã€‚

### æœ¬åœ°éƒ¨ç½²

#### Windows ç³»ç»Ÿ

æœ¬é¡¹ç›®æä¾› Windows ç³»ç»Ÿä¸‹æºä»£ç çš„ä¸‹è½½è°ƒè¯•æ–¹æ³•ã€‚ä¸æä¾› Windows ç³»ç»Ÿçš„å…¬ç½‘éƒ¨ç½²æ–¹å¼ã€‚

##### ä¸­é—´ä»¶åŠä¾èµ–ç¯å¢ƒè¦æ±‚

æœ¬é¡¹ç›®é‡‡ç”¨çš„ä¸»è¦è½¯ä»¶ç‰ˆæœ¬ä¸ºï¼š

| åç§°    | ç‰ˆæœ¬   |
| ------- | ------ |
| vue     | 3.3.2  |
| node.js | 20.0.0 |
| npm     | 9.6.4  |

å»ºè®®é‡‡ç”¨æœ€æ–°çš„ lts ç‰ˆæœ¬å³ç¨³å®šç‰ˆéƒ¨ç½²è°ƒè¯•æœ¬é¡¹ç›®ã€‚

##### å®‰è£…æ­¥éª¤

- **ä¸‹è½½ä»£ç åŒ…**

```shell
git clone https://github.com/BUAA-SEF-Team15/Learning_and_Living_Platform_FrontEnd.git
cd Learning_and_Living_Platform_FrontEnd
```

- **å®‰è£…å¿…è¦çš„ä¾èµ–**

```shell
#è‹¥æœªä½¿ç”¨è¿‡ npm
#è¯·å…ˆè¿è¡Œ npm init
npm install
```

- **æœ¬åœ°å¯åŠ¨é¡¹ç›®**

```shell
npm run dev
```

è‹¥ç»ˆç«¯äº§ç”Ÿå¦‚ä¸‹è¾“å‡ºï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸï¼š

```shell
> learning-and-living-platform@0.0.0 dev
> vite


  VITE v4.3.8  ready in 1357 ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
  âœ  press h to show help
```

æ‰“å¼€æµè§ˆå™¨ï¼Œè¿›å…¥`localhost:5173`è®¿é—®å‰ç«¯é¡µé¢å³å¯è¿›è¡Œè°ƒè¯•ã€‚



### äº‘ç«¯éƒ¨ç½²

#### äº‘æœåŠ¡å™¨ Linux(CentOS) ç³»ç»Ÿ

æœ¬é¡¹ç›®æä¾›äº‘æœåŠ¡å™¨ Linux(CentOS) ç³»ç»Ÿä¸‹çš„éƒ¨ç½²æ–¹æ³•ã€‚

##### ä¸­é—´ä»¶åŠä¾èµ–ç¯å¢ƒè¦æ±‚

é™¤äº†ä¸Šæ–‡ Windows ç³»ç»Ÿæ‰€éœ€ä¾èµ–å¯¹åº”çš„ç›¸åº” Linux(CentOS) ç‰ˆæœ¬å¤–ï¼Œè¿˜éœ€è¦ä»¥ä¸‹è½¯ä»¶ï¼š

| åç§°   | ç‰ˆæœ¬     |
| ------ | -------- |
| Xshell | 7.0.0030 |
| Xftp   | 7.0.0107 |
| Nginx  | 1.25.0   |

- `Xshell`ç”¨äºè¿æ¥è¿è¡Œè¿œç¨‹æœåŠ¡å™¨ã€‚
- `Xftp`ç”¨äºä¸è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œæ•°æ®ä¼ è¾“ï¼ˆå¯é€‰ï¼‰ã€‚
- `Nginx`ç”¨äºéƒ¨ç½²è¿è¡Œ`vue`é¡¹ç›®ã€‚

##### Xshellä½¿ç”¨

`Xshell`è¿æ¥è¿œç¨‹æœåŠ¡å™¨å¯ä»¥é‡‡å–å¯†ç æˆ–SSHå¯†é’¥ä¸¤ç§æ–¹å¼ã€‚æœ¬é¡¹ç›®ä½¿ç”¨å¯†ç æ–¹å¼ï¼ˆå¯†é’¥æ–¹å¼å°†å†éšåçš„æ–‡æ¡£ä¸­ä»‹ç»ï¼‰ï¼Œå…·ä½“æ–¹å¼å¯ä»¥å‚è€ƒ`Xshell`å®˜æ–¹æ–‡æ¡£[Technical Support - NetSarang Computer (atlassian.net)](https://netsarang.atlassian.net/wiki/spaces/ENSUP/overview?desktop=true)ã€‚è¿™é‡Œåº”æ³¨æ„å®‰å…¨ç»„ç­–ç•¥å’Œé˜²ç«å¢™çš„é…ç½®ã€‚

`Xshell`è¿æ¥è¿œç¨‹ä¸»æœºåç¤ºä¾‹å¦‚ä¸‹ï¼š

![](.\img\4.png)

é€šè¿‡`Xshell`è¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œä½¿ç”¨`yum`å‘½ä»¤è¡Œè¿›è¡Œç›¸å…³ä¾èµ–ä¸‹è½½ã€‚è¿™é‡Œé»˜è®¤åŸºæœ¬ä¾èµ–å·²ç»é…ç½®å®Œæ¯•ï¼ˆä¾‹å¦‚`C/C++ gdb`ï¼‰ï¼Œä¸‹é¢ä¸»è¦ä»‹ç»å‰ç«¯é¡¹ç›®çš„éƒ¨ç½²å’Œ`Nginx`ä¸‹è½½é…ç½®ã€‚

##### Xftpä½¿ç”¨

`Xftp`ä¸»è¦ç”¨äºå®ç°æ–‡ä»¶çš„è¿œç¨‹ä¼ è¾“ã€‚è¿œç¨‹æœåŠ¡å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨`git`æ‹‰å–`Github`æºä»£ç ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼**ç›´æ¥è·å–æ‰“åŒ…å¥½**çš„é¡¹ç›®ï¼Œä¸‹é¢ä½¿ç”¨`Xftp`å®ç°ã€‚

- è‹¥åœ¨æœ¬åœ°å·²ç»æœ‰å‰ç«¯å·¥ä½œé¡¹ç›®ï¼Œé¦–å…ˆå¯¼å‡ºvueé¡¹ç›®ï¼š

```
#æ³¨æ„ä¿®æ”¹ vue é¡¹ç›®ä¸­ç›¸å…³è·¯å¾„çš„é…ç½®ï¼Œå¦‚ baseUML
npm run build
```

- ç¨‹åºæ­£ç¡®æ‰§è¡Œåï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å‡ºç°`dist`æ–‡ä»¶å¤¹ï¼Œå…¶ä¸ºæ‰“åŒ…å¥½çš„é¡¹ç›®ã€‚ä½¿ç”¨`Xftp`è¿æ¥è¿œç¨‹æœåŠ¡å™¨åä¼ è¾“è¯¥æ–‡ä»¶ï¼ˆ`Xftp`è¿æ¥æ–¹å¼å¯å‚è€ƒ`Xshell`ï¼‰ã€‚

![](.\img\3.png)

##### Nginxé…ç½®è¿è¡Œ

- è®¿é—®[nginx: download](http://nginx.org/en/download.html)ä¸‹è½½æˆ–ç›´æ¥ä½¿ç”¨

```
yum install nginx
```

- è§£å‹`Nginx`æ–‡ä»¶

```
tar -zxvf nginx-1.25.0.tar.gz
```

- é…ç½®å¹¶è¿è¡Œ`Nignx`

```
#ä¸‹è½½ç›¸å…³ä¾èµ–
yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel
#é…ç½®å¹¶åˆå§‹åŒ–ï¼Œæ‰§è¡Œ./configureå‘½ä»¤
./configure
#ç¼–è¯‘å¹¶å®‰è£…
make
make install
#å…è®¸è¿è¡ŒNginx
sudo systemctl enable nginx
```

- `Nginx`ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹åˆ—æ–¹å¼å¯åŠ¨ï¼š

```
#ç¼–è¯‘å®‰è£…å®Œåï¼Œåœ¨ /usr/local/ ç›®å½•ä¸‹ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª nginx ç›®å½•ï¼Œä»£è¡¨å®‰è£…æˆåŠŸ!
cd /usr/local/nginx/sbin/      è¿›å…¥ sbin ç›®å½•
./nginx                        å¯åŠ¨ Nginx
```

- é˜²ç«å¢™æ”¾è¡Œç«¯å£

`Nginx` é»˜è®¤ç«¯å£ä¸º 80ï¼Œè®¿é—® `localhost:80` ï¼Œ**å‡ºç° `Welcome to nginx!` è¡¨ç¤ºæˆåŠŸ**

- ä¿®æ”¹nginxé…ç½®æ–‡ä»¶

```
cd /usr/local/nginx/conf/
vim nginx.conf
```

åœ¨`nginx.conf`æ–‡ä»¶ä¸­ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š

```
user  root;	//è®¾ç½®nginxçš„ä½¿ç”¨ç”¨æˆ·
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {

		...

    server {
        listen       80;	//è®¾ç½®ç›‘å¬ç«¯å£
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   /root/front/dist;	//è®¾ç½®distç›®å½•ï¼Œå³ä¸Šä¸€æ­¥Xftpä¼ è¾“çš„æ‰“åŒ…ç›®å½•
            index  index.html index.htm;
        }

				...

    }

}
```

- é‡å¯nginx æœåŠ¡

```
./nginx -s reload
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåœ¨äº‘æœåŠ¡å™¨é€šè¿‡`Nginx`è¿è¡Œ`Vue`é¡¹ç›®ï¼Œè¿è¡Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š

![](.\img\7.png)

ï¼ˆç”±äºè¿™é‡Œå°šæœªéƒ¨ç½²åç«¯ï¼Œæ•…æ— å…·ä½“å†…å®¹ï¼ŒåèŠ‚å°†ä»‹ç»åç«¯éƒ¨ç½²æ–¹æ³•ï¼‰



### æœ¬åœ°éƒ¨ç½²ï¼ˆDockerï¼‰

å¦‚æœæ‚¨è®¤ä¸ºä¸Šè¿°æœ¬åœ°éƒ¨ç½²æ–¹å¼è¾ƒä¸ºç¹çï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨`Docker Hub`ä¸‹è½½æˆ‘ä»¬å·²ç»å‘å¸ƒçš„é•œåƒæ–‡ä»¶è¿è¡Œã€‚æœ¬é¡¹ç›®æä¾›å•ç‹¬çš„`docker`é•œåƒæ¥è¿è¡Œå‰ç«¯é¡¹ç›®ï¼Œä¹Ÿæä¾›å‰åç«¯ä¸€ä½“å¼çš„`Docker Dev Environment`å¼€å‘ç¯å¢ƒéƒ¨ç½²ï¼Œæœ¬èŠ‚ä»…ä»‹ç»å‰ä¸€ç§`docker`é•œåƒï¼Œè€Œå°†`Docker Dev Environment`å¼€å‘ç¯å¢ƒéƒ¨ç½²æ”¾åœ¨åèŠ‚ï¼Œä½†æ˜¯è¦è®¤è¯†åˆ°æ„å»º`docker`é•œåƒæ˜¯åè€…ä½¿ç”¨çš„åŸºç¡€ã€‚

`Docker`ç‰ˆæœ¬ä¾èµ–å¦‚ä¸‹ï¼š

| åç§°   | ç‰ˆæœ¬   |
| ------ | ------ |
| Docker | 24.0.2 |

ä¸‹é¢å°†ä»‹ç» Docker é•œåƒæ„å»ºã€ä¸‹è½½å’Œä½¿ç”¨çš„æ–¹æ³•ã€‚

#### æ„å»º

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å»ºç«‹`default.conf`ã€`dist`ã€`Dockerfile`æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­ï¼Œ`default.conf`æä¾›`Nginx`é•œåƒçš„é…ç½®æ–‡ä»¶ï¼Œ`dist`æ˜¯æ‰“åŒ…å¥½çš„é¡¹ç›®æ–‡ä»¶ï¼Œ`Dockerfile`æ˜¯`Docker`æ„å»ºæ–‡ä»¶ã€‚

- `Docker`æ‹‰å»`Nginx`é•œåƒ

```
docker pull nginx:1.25.0
```

- é…ç½®`Dockerfile`æ–‡ä»¶

```dockerfile
#è¯´æ˜é•œåƒæº
FROM nginx:1.20.2
#ä½œè€…
LABEL maintainer="WYK827906540@163.com"
#é…ç½®æ–‡ä»¶
RUN rm /etc/nginx/conf.d/default.conf	
ADD default.conf /etc/nginx/conf.d/	
#å°†é¡¹ç›®å¤åˆ¶åˆ°æœ¬åœ°
COPY dist/ /usr/share/nginx/html/
```

- é…ç½®`default.conf`æ–‡ä»¶

```
server {
    listen       80;
    server_name  8.130.11.33;
 
    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
        try_files $uri $uri/ /index.html =404;
    }
 
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }
}
```

é…ç½®å†…å®¹å’Œä¹‹å‰çš„`Nginx`é…ç½®æ–‡ä»¶ç›¸ä¼¼ã€‚

- æ„å»º`Docker`é•œåƒ

```
docker build -t hathoric/lal_front:v0 .
```

- ä¸Šä¼ `Docker`é•œåƒ

```
docker push hathoric/lal_front:v0
```

è‡³æ­¤ï¼Œ`Docker`é•œåƒå·²ç»æ„å»ºä¸Šä¼ å®Œæ¯•ã€‚

#### æ‹‰å»è¿è¡Œ Docker é•œåƒ

- æ‹‰å»`Docker`é•œåƒ

```
docker pull hathoric/lal_front:v0
```

- è¿è¡Œ`Docker`é•œåƒ

```
docker run -d -p 80:80 --name mynginx -d hathoric/lal_front:v0
```

- æŸ¥çœ‹è¿è¡Œæƒ…å†µ

```
docker ps
```

è‹¥ä»¥ä¸Šé•œåƒæ­£åœ¨è¿è¡Œï¼Œåˆ™å¯ä»¥æ‰“å¼€æµè§ˆå™¨çš„æœ¬åœ°`80`ç«¯å£æŸ¥çœ‹è¿è¡Œæƒ…å†µã€‚



### è¿œç¨‹éƒ¨ç½²ï¼ˆGithub actionï¼‰

#### CD æµæ°´çº¿è®¾è®¡

CI/CDï¼ˆæŒç»­é›†æˆ/æŒç»­äº¤ä»˜ï¼‰æµæ°´çº¿æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–çš„è½¯ä»¶å¼€å‘å®è·µï¼Œæ—¨åœ¨å®ç°å¿«é€Ÿã€å¯é å’Œé¢‘ç¹çš„è½¯ä»¶äº¤ä»˜ã€‚å®ƒé€šè¿‡å°†è½¯ä»¶å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²çš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Œå¸®åŠ©å›¢é˜Ÿæ›´åŠ é«˜æ•ˆåœ°æ„å»ºå’Œäº¤ä»˜è½¯ä»¶ã€‚åœ¨å½“å‰ DevOps çš„è¶‹åŠ¿ä¸‹ï¼ŒæŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰å…·æœ‰æ”¯æŸ±æ€§åœ°ä½ï¼Œæˆ‘ä»¬å°†æ ¹æ®ä»£ç é›†æˆ->æ„å»ºå’Œæµ‹è¯•->éƒ¨ç½²å’Œå‘å¸ƒ->è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²çš„æµç¨‹ä»‹ç» CD æµæ°´çº¿è®¾è®¡ã€‚

![](.\img\8.png)

##### ä»£ç é›†æˆ

æœ¬é¡¹ç›®é€šè¿‡`git`è¿›è¡Œç‰ˆæœ¬æ§åˆ¶å¼€å‘ï¼Œä½¿ç”¨`github`ä½œä¸ºä»“åº“ï¼Œå°†ä»£ç åˆå¹¶åˆ°å…±äº«çš„ä»£ç åº“ä¸­ï¼Œå¹¶ä½¿ç”¨æŒç»­é›†æˆå·¥å…·`github action`è‡ªåŠ¨ç›‘æµ‹ä»£ç åº“çš„å˜æ›´ï¼Œå¹¶è§¦å‘æ„å»ºè¿‡ç¨‹ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¿é—®`github`å…·ä½“é¡¹ç›®é¡µæ¥æŸ¥çœ‹æˆ‘ä»¬çš„ä»£ç é›†æˆæƒ…å†µã€‚

> [BUAA-SEF-Team15/Learning_and_Living_Platform_FrontEnd: FrontEnd repository for Learning_and_Living_Platform (github.com)](https://github.com/BUAA-SEF-Team15/Learning_and_Living_Platform_FrontEnd)

##### æ„å»ºå’Œæµ‹è¯•

åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ä¼šæ ¹æ®ä»£ç åº“ä¸­çš„æ›´æ–°æ„å»ºåº”ç”¨ç¨‹åºæˆ–è½¯ä»¶åŒ…ã€‚æ„å»ºè¿‡ç¨‹é€šå¸¸åŒ…æ‹¬ç¼–è¯‘æºä»£ç ã€æ‰“åŒ…ã€ä¾èµ–é¡¹ç®¡ç†ç­‰ã€‚éšåï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ä¼šè¿è¡Œå„ç§ç±»å‹çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ï¼Œä»¥éªŒè¯ä»£ç çš„æ­£ç¡®æ€§å’ŒåŠŸèƒ½æ€§ã€‚

- ä»£ç åœ¨é€šè¿‡ç‰ˆæœ¬æ§åˆ¶é˜¶æ®µä¹‹åï¼Œä¼šå…ˆåœ¨æ„å»ºé˜¶æ®µäºˆä»¥ç¼–è¯‘ã€‚è¯¥é˜¶æ®µä¼šä»ä»£ç åº“çš„å„ä¸ªåˆ†æ”¯ä¸­è·å–åˆ°æ‰€æœ‰çš„åŠŸèƒ½ä»£ç ï¼Œåˆå¹¶åæœ€ç»ˆé€šè¿‡ä¸€ä¸ªç¼–è¯‘å™¨æ¥ç¼–è¯‘å®ƒä»¬ã€‚
- æ„å»ºé˜¶æ®µç»“æŸåï¼Œå°†ä¼šç»§ç»­è¿›å…¥åˆ°ä»£ç çš„æµ‹è¯•é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬ä¼šè¿›è¡Œå„ç§å„æ ·çš„æµ‹è¯•ï¼Œå•å…ƒæµ‹è¯•å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚åœ¨è¯¥é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬ä¼šæµ‹è¯•ä»£ç ä¸­å¤šä¸ªç»„ä»¶é—´çš„å…³ç³»æˆ–è€…å•ä¸ªç»„ä»¶çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿä¼šè¿›è¡Œè½¯ä»¶çš„å¯ç”¨æ€§æµ‹è¯•ã€‚

æˆ‘ä»¬é‡‡ç”¨`Github`è‡ªå¸¦çš„`github action`ï¼Œåˆ›å»ºç›¸å…³å·¥ä½œæµè¿›è¡Œæ„å»ºå’Œæµ‹è¯•ï¼Œå½“ç»„å‘˜äº§ç”Ÿ`push`æˆ–`pull request`æ“ä½œåï¼Œ`github action`è‡ªåŠ¨æ£€æµ‹åˆ°è¯¥æ“ä½œï¼Œç„¶åè¿›è¡Œé¡¹ç›®çš„è‡ªåŠ¨åŒ–è¿œç¨‹éƒ¨ç½²æ„å»ºæµ‹è¯•ã€‚è‹¥æˆåŠŸï¼Œåˆ™å®Œæˆä¸€æ¬¡å·¥ä½œæµï¼›è‹¥å¤±è´¥ï¼Œåˆ™ä¸­æ­¢å·¥ä½œæµå¹¶æŠ¥é”™ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ç»„å‘˜`push`çš„ä»£ç å‡ºç°äº†è¯­æ³•é”™è¯¯ï¼Œåˆ™ä¼šæ„å»ºå¤±è´¥å¹¶æŠ¥é”™ï¼Œæç¤ºå¼€å‘äººå‘˜æ£€æŸ¥ä»£ç æ­£ç¡®æ€§ã€‚

![](.\img\9.png)

`github action`ä¼šåœ¨é”™è¯¯çš„æ­¥éª¤è¿›è¡Œæç¤ºï¼Œä»¥ä¾¿å¼€å‘è€…æ£€æŸ¥ã€‚

##### éƒ¨ç½²å’Œå‘å¸ƒ

ä¸€æ—¦æ„å»ºå’Œæµ‹è¯•é˜¶æ®µæˆåŠŸå®Œæˆï¼ŒCI/CD æµæ°´çº¿å°†è‡ªåŠ¨å°†æ„å»ºçš„åº”ç”¨ç¨‹åºæˆ–è½¯ä»¶åŒ…éƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒä¸­ï¼Œå¦‚å¼€å‘ã€æµ‹è¯•æˆ–ç”Ÿäº§ç¯å¢ƒã€‚éƒ¨ç½²å¯ä»¥åŒ…æ‹¬å°†åº”ç”¨ç¨‹åºæ¨é€åˆ°æœåŠ¡å™¨ã€é…ç½®è¿è¡Œæ—¶ç¯å¢ƒã€æ•°æ®åº“è¿ç§»ç­‰æ“ä½œã€‚æ­¤å¤–ï¼Œæµæ°´çº¿è¿˜å¯ä»¥é›†æˆè‡ªåŠ¨åŒ–å‘å¸ƒå·¥å…·ï¼Œå°†è½¯ä»¶å‘å¸ƒåˆ°åº”ç”¨å•†åº—æˆ–äº‘å¹³å°ã€‚

- åœ¨è¯¥é˜¶æ®µï¼Œä»£ç å°†ä¼šè¢«éƒ¨ç½²åˆ°å‡†ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ï¼ˆstaging serverï¼‰æˆ–è€…æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨ï¼ˆtest serverï¼‰ä¸­ã€‚åŒæ—¶åœ¨è¯¥é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥æŸ¥çœ‹ç¨‹åºä»£ç ï¼Œä¹Ÿå¯ä»¥åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œè¯¥åº”ç”¨ç¨‹åºã€‚

åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œ`Github action`è‡ªåŠ¨éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨å¹¶è¿›è¡Œ`Nginx`çš„é‡å¯ï¼Œå°†æœ€æ–°ç‰ˆé¡¹ç›®æ›´æ–°ã€‚ä¸€æ¬¡æˆåŠŸçš„è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š
![](.\img\10.png)

##### è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²

CI/CD æµæ°´çº¿çš„ç›®æ ‡æ˜¯å®ç°å…¨é¢çš„è‡ªåŠ¨åŒ–ï¼Œä»¥å‡å°‘äººä¸ºå¹²é¢„å’Œå‡å°‘äººå·¥é”™è¯¯ã€‚é€šè¿‡è‡ªåŠ¨åŒ–æ•´ä¸ªè½¯ä»¶äº¤ä»˜è¿‡ç¨‹ï¼Œå›¢é˜Ÿå¯ä»¥æ›´å¿«åœ°å°†æ–°åŠŸèƒ½ã€ä¿®å¤å’Œæ”¹è¿›çš„ä»£ç äº¤ä»˜ç»™æœ€ç»ˆç”¨æˆ·ã€‚åŒæ—¶ï¼ŒCI/CD æµæ°´çº¿è¿˜æä¾›äº†å®æ—¶åé¦ˆå’Œç›‘æ§æœºåˆ¶ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°å’Œè§£å†³æ½œåœ¨çš„é—®é¢˜ã€‚åªè¦æˆ‘ä»¬çš„ä»£ç éƒ¨ç½²æˆåŠŸï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œå¦ä¸€ç»„å¯ç”¨æ€§æµ‹è¯•äº†ã€‚è¯¥é˜¶æ®µç»“æŸåï¼Œå¦‚æœæ‰€æœ‰çš„æµ‹è¯•éƒ½é€šè¿‡äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†å…¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­äº†ã€‚

- å¦‚æœåœ¨æ‰§è¡Œæµ‹è¯•çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä»»ä½•é”™è¯¯ï¼Œé‚£ä¹ˆè¿™äº›é”™è¯¯ä¹Ÿå°†åé¦ˆç»™å¼€å‘å›¢é˜Ÿï¼Œç­‰ä»–ä»¬ä¿®å¤å®Œæˆåï¼ŒåŒæ ·ä¼šå†æ¬¡è§¦å‘è¯¥æµæ°´çº¿ï¼Œè¿›è¡Œæ–°ä¸€è½®çš„æŒç»­è¿­ä»£ã€‚

å› æ­¤ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸå°†ä¼šç»§ç»­è¿­ä»£ä¸‹å»ï¼Œç›´åˆ°æˆ‘ä»¬å¾—åˆ°å¯ä»¥ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„ä»£ç æˆ–è€…äº§å“ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬è¿˜éœ€è¦å¯¹ä»£ç è¿›è¡Œåº¦é‡å’ŒéªŒè¯ï¼Œä»¥å®æ—¶ç›‘æ§åº”ç”¨çš„çº¿ä¸Šè¿è¡ŒçŠ¶æ€ã€‚

##### ä½¿ç”¨ CI/CD æµæ°´çº¿çš„å¥½å¤„

- æ›´å¿«çš„äº¤ä»˜ï¼šè‡ªåŠ¨åŒ–æµç¨‹å¯ä»¥å‡å°‘äººä¸ºå¹²é¢„å’Œæ‰‹åŠ¨æ­¥éª¤ï¼ŒåŠ å¿«è½¯ä»¶äº¤ä»˜é€Ÿåº¦ã€‚
- æ›´é«˜çš„è´¨é‡ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å’ŒæŒç»­é›†æˆå¯ä»¥åŠæ—©å‘ç°å’Œçº æ­£é—®é¢˜ï¼Œæé«˜è½¯ä»¶è´¨é‡ã€‚
- æ›´å¥½çš„å¯é æ€§ï¼šé€šè¿‡è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œå‘å¸ƒï¼Œå‡å°‘äº†äººä¸ºé”™è¯¯å’Œé…ç½®æ¼æ´çš„é£é™©ã€‚
- æ›´é«˜çš„å›¢é˜Ÿåä½œï¼šCI/CD ä¿ƒè¿›äº†å›¢é˜Ÿå†…çš„åä½œå’Œæ²Ÿé€šï¼Œå‡å°‘äº†é›†æˆé—®é¢˜å’Œå†²çªã€‚

#### Github actionå®ç°

æœ¬åœ°éƒ¨ç½²æ–¹å¼è¾ƒä¸ºéº»çƒ¦ï¼Œä¹Ÿä¸ä¾¿äºç›¸å…³å¼€å‘è°ƒè¯•ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨`github action`è‡ªåŠ¨åŒ–è¿›è¡Œ`push`åçš„ä»£ç è¿œç¨‹éƒ¨ç½²è¿è¡Œã€‚æœ‰å…³`github action`çš„æœ‰å…³ä»‹ç»å¯ä»¥å‚è€ƒ[GitHub Actionsæ–‡æ¡£ - GitHub æ–‡æ¡£](https://docs.github.com/zh/actions)ã€‚ä¸‹é¢ä»…ä»‹ç»ç›¸å…³`workflows`æ–‡ä»¶é…ç½®ã€‚

- åœ¨`github`é¡¹ç›®`action`æ æ–°å»º`new workflow`

![](.\img\5.png)

å¯ä»¥ä½¿ç”¨å·²ç»å­˜åœ¨çš„å„ç±»è¯­è¨€æ–‡ä»¶æ¨¡æ¿ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ–°å»º`yml`æ–‡ä»¶ã€‚

- é…ç½®`.yml`æ–‡ä»¶

```yml
name: frontend-build
#æŒ‡å®šå·¥ä½œæµè‡ªåŠ¨åŒ–è¿è¡Œçš„æ¡ä»¶
on: 
  push: 
    branches: 
      - main
jobs:
  build-and-deploy:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false
      
      # æŒ‡å®š node ç‰ˆæœ¬
      - uses: actions/setup-node@v2 
        with:
          node-version: '20'

      - name: Build
        run: |
          npm install  # å®‰è£…ä¾èµ–
          npm run build  # æ‰§è¡Œæ‰“åŒ…
  
      - name: Deploy ğŸš€
        uses: cross-the-world/scp-pipeline@master
        env:
          WELCOME: "ssh scp ssh pipelines"
          LASTSSH: "Doing something after copying"
        with:
         host: ${{ secrets.SERVER_HOST }}
         user: ${{ secrets.SERVER_USER }}
         pass: ${{ secrets.SERVER_SSH_KEY }}
         connect_timeout: 10s
         local: dist
         remote: /root/frontend
         last_ssh: |
            nginx -s reload # éƒ¨ç½²æˆåŠŸåéœ€è¦é‡å¯nginx
```

ä¸ºäº†å®‰å…¨ï¼Œå°†ä»£ç ä¸­æ¶‰åŠçš„`SERVER_HOST`ã€`SERVER_USER`ã€`SERVER_SSH_KEY`æ”¾ç½®åœ¨`github`é¡¹ç›®é…ç½®ä¸­ã€‚

- é…ç½®ä¸Šè¿°çš„å†…å®¹åœ¨æœ¬é¡¹ç›®ä¸­ã€‚

![](.\img\6.png)

`SERVER_HOST`ä¸ºè¿œç¨‹ä¸»æœºçš„å…¬ç½‘IP

`SERVER_USER`ä¸ºè¿œç¨‹ä¸»æœºçš„ç”¨æˆ·åï¼Œä¸€èˆ¬ä¸º`root`

`SERVER_SSH_KEY`ä¸ºè¿æ¥è¿œç¨‹ä¸»æœºçš„`SSH`å¯†é’¥

`Github action`æä¾›äº†å…è´¹çš„è™šæ‹Ÿå·¥ä½œæœºå®Œæˆ`.yml`è§„å®šçš„æ“ä½œï¼Œå®ƒå¯ä»¥å®ç°è‡ªåŠ¨æ£€æŸ¥å’Œéƒ¨ç½²ï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘æµç¨‹ï¼Œæé«˜äº†å·¥ä½œæ•ˆç‡ã€‚

##### SSHå¯†é’¥é…ç½®

æœ¬é¡¹ç›®é‡‡å–çš„é˜¿é‡Œäº‘è¿œç¨‹ä¸»æœºï¼Œæ‰€ä»¥åœ¨`SSH`å¯†é’¥é…ç½®ä¸Šä¸å¤§éƒ¨åˆ†æ–¹æ³•ä¸åŒã€‚é˜¿é‡Œäº‘ä¸æ”¯æŒç›´æ¥ä½¿ç”¨è¿œç¨‹ä¸»æœºç”Ÿæˆçš„å¯†é’¥ï¼Œè€Œæ˜¯è¦ä½¿ç”¨å¹³å°æä¾›çš„å¯†é’¥ã€‚ç”¨æˆ·éœ€è¦åœ¨å®ä¾‹çš„æ§åˆ¶é¢æ¿ä¸Šçš„`ç½‘ç»œä¸å®‰å…¨`ä¸­é€‰æ‹©`å¯†é’¥å¯¹`ï¼Œåˆ›å»ºä¸€ä¸ªå¯†é’¥å¯¹ï¼Œç„¶åå°†ç”Ÿæˆçš„`.pem`æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°`.ssh`æ–‡ä»¶å¤¹å†…ï¼ˆå¦‚æœéœ€è¦æœ¬åœ°ç»ˆç«¯è®¿é—®ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å¯†é’¥ä¿å­˜è‡³ç”Ÿæˆçš„`SERVER_SSH_KEY`ä¸­ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬æ— æ³•é‡‡ç”¨ç”¨æˆ·å¯†ç çš„æ–¹å¼ä½¿ç”¨`Xshell`ç™»å½•è¿œç¨‹ä¸»æœºï¼Œè€Œæ˜¯è¦é‡‡å–åŒæ ·çš„æ–¹æ³•ï¼Œå› æ­¤å¯†é’¥å¿…é¡»**å¦¥å–„ä¿å­˜**ã€‚é˜¿é‡Œäº‘çš„å®‰å…¨æœºåˆ¶ä½¿å¾—ç½‘ä¸Šå¤§éƒ¨åˆ† SSH æ•™ç¨‹æ— æ•ˆï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨æœ¬åœ°ç”Ÿæˆçš„ SSH å¯†é’¥ï¼ˆå…¬é’¥ï¼‰ä¿å­˜è‡³è¿œç¨‹ä¸»æœºï¼Œ`Github action`ä¿å­˜ç§é’¥çš„å½¢å¼è®¿é—®ã€‚å…·ä½“å‚è€ƒé˜¿é‡Œäº‘ ECS æ–‡æ¡£[é€šè¿‡å¯†ç æˆ–å¯†é’¥è®¤è¯ç™»å½•Linuxå®ä¾‹ (aliyun.com)](https://help.aliyun.com/document_detail/147650.html?spm=5176.ecscore_.help.dexternal.35af4df5N9nONX)ã€‚

##### å…¶ä»–é€‰æ‹©

`Github action`è¿˜æœ‰å…¶ä»–ç±»ä¼¼äº `fifsky/ssh-action@master` çš„é€‰æ‹©ï¼Œä¾‹å¦‚æ‚¨å¯ä»¥é€‰æ‹©ï¼š

1. `appleboy/ssh-action`: è¿™ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªä½¿ç”¨ SSH è¿æ¥åˆ°è¿œç¨‹ä¸»æœºæ‰§è¡Œå‘½ä»¤çš„ç®€å•æ–¹æ³•ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½®è¾“å…¥å‚æ•°æ¥æŒ‡å®šè¦è¿æ¥çš„ä¸»æœºã€ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯ã€‚
2. `webfactory/ssh-agent`: è¿™ä¸ªæ“ä½œå…è®¸æ‚¨åœ¨ GitHub Actions ä¸­ä½¿ç”¨ SSH ä»£ç†è¿›è¡Œè¿æ¥ã€‚å®ƒå¯ä»¥åŠ è½½ SSH å¯†é’¥å¹¶å°†å…¶æ·»åŠ åˆ°ä»£ç†ä¸­ï¼Œä»¥ä¾¿åœ¨åç»­æ­¥éª¤ä¸­ä½¿ç”¨ã€‚
3. `pantheon-systems/terminus-deploy`: è¿™ä¸ªæ“ä½œç”¨äºåœ¨ Pantheon å¹³å°ä¸Šè¿›è¡Œéƒ¨ç½²ã€‚å®ƒä½¿ç”¨ SSH è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ã€‚

å…·ä½“è¿™äº›é€‰æ‹©çš„æ“ä½œå’Œä»£ç è¯·å‚è€ƒå„è‡ªçš„`Github`ç½‘ç«™å’Œæ–‡æ¡£ã€‚



## åç«¯å®‰è£…éƒ¨ç½²æŒ‡å—

*è¯´æ˜ï¼šæœ¬é¡¹ç›®é‡‡å–äº‘æ•°æ®åº“ï¼Œæ‰€ä»¥**ä¸éœ€è¦**é…ç½®æ•°æ®åº“ã€‚*

### æœ¬åœ°éƒ¨ç½²

#### Windows ç³»ç»Ÿ

æœ¬é¡¹ç›®æä¾› Windows ç³»ç»Ÿä¸‹æºä»£ç çš„ä¸‹è½½è°ƒè¯•æ–¹æ³•ã€‚ä¸æä¾› Windows ç³»ç»Ÿçš„å…¬ç½‘éƒ¨ç½²æ–¹å¼ã€‚

##### ä¸­é—´ä»¶åŠä¾èµ–ç¯å¢ƒè¦æ±‚

æœ¬é¡¹ç›®é‡‡ç”¨çš„ä¸»è¦è½¯ä»¶ç‰ˆæœ¬ä¸ºï¼š

| åç§°          | ç‰ˆæœ¬                        |
| ------------- | --------------------------- |
| Apache Maven  | 3.9.2                       |
| IntelliJ IDEA | 2023.1.1                    |
| jdk           | azul/zulu-openjdk-centos:19 |
| tomcat        | 10.1.9                      |
| postman       | 10.14.2                     |

å»ºè®®é‡‡ç”¨ç›¸åŒçš„æˆ–æ›´é«˜çš„`jdk`ç‰ˆæœ¬éƒ¨ç½²è°ƒè¯•æœ¬é¡¹ç›®ã€‚

##### å®‰è£…æ­¥éª¤

- **ä¸‹è½½ä»£ç åŒ…**

```shell
git clone https://github.com/BUAA-SEF-Team15/Learning_and_Living_Platform_BackEnd.git
cd Learning_and_Living_Platform_BackEnd
```

- **å®‰è£…å¿…è¦çš„ä¾èµ–**

```shell
#è¯·ä½¿ç”¨OPENjdk18çš„ç›¸ä¼¼æˆ–æ›´é«˜ç‰ˆæœ¬
#ä¾‹å¦‚ä½¿ç”¨scoopä¸‹è½½
scoop install java/zulu18-jdk
```

- **æœ¬åœ°å¯åŠ¨é¡¹ç›®**

é‡‡ç”¨`IntelliJ IDEA`æ‰“å¼€å¹¶è¿è¡Œé¡¹ç›®ï¼š

![](.\img\11.png)

è‹¥ç»ˆç«¯äº§ç”Ÿå¦‚ä¸‹è¾“å‡ºï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸï¼š

```shell
...

C:\Users\WYK82\.m2\repository\com\google\code\gson\gson\2.9.1\gson-2.9.1.jar com.example.lal.LalApplication

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.0.7)

2023-06-05T15:54:52.860+08:00  INFO 17352 --- [           main] com.example.lal.LalApplication           : Starting LalApplication using Java 19.0.1 with PID 17352 (E:\SoftwarePrograms\LAL_DEMO\Learning_and_Living_Platform_BackEnd\target\classes started by WYK82 in E:\SoftwarePrograms\LAL_DEMO\Learning_and_Living_Platform_BackEnd)
2023-06-05T15:54:52.870+08:00  INFO 17352 --- [           main] com.example.lal.LalApplication           : No active profile set, falling back to 1 default profile: "default"
2023-06-05T15:54:54.013+08:00  INFO 17352 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JDBC repositories in DEFAULT mode.
2023-06-05T15:54:54.069+08:00  INFO 17352 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 42 ms. Found 0 JDBC repository interfaces.
2023-06-05T15:54:54.976+08:00  INFO 17352 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2023-06-05T15:54:55.007+08:00  INFO 17352 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2023-06-05T15:54:55.007+08:00  INFO 17352 --- [           main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.8]
2023-06-05T15:54:55.117+08:00  INFO 17352 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2023-06-05T15:54:55.117+08:00  INFO 17352 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 2145 ms
2023-06-05T15:54:56.857+08:00  INFO 17352 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2023-06-05T15:54:57.290+08:00  INFO 17352 --- [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@3c60c681
2023-06-05T15:54:57.290+08:00  INFO 17352 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2023-06-05T15:54:57.510+08:00  INFO 17352 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
æ£€æŸ¥åœ¨çº¿ç”¨æˆ·è¡¨ä¸­tokenè¿‡æœŸçš„ä»»åŠ¡å¼€å§‹æ‰§è¡Œ:
2023-06-05T15:54:57.525+08:00  INFO 17352 --- [           main] com.example.lal.LalApplication           : Started LalApplication in 5.39 seconds (process running for 6.186)
è¯·è¾“å…¥æŒ‡ä»¤ï¼š
1çš„Token è¿‡æœŸæ—¶é—´: Mon Jun 05 16:06:49 CST 2023

...
```

ä¹‹åå¯ä»¥ä½¿ç”¨`postman`é€šè¿‡`localhost:8080`ç«¯å£è¿›è¡Œ`RESTFUL`è¯·æ±‚æµ‹è¯•ã€‚



### äº‘ç«¯éƒ¨ç½²

#### äº‘æœåŠ¡å™¨ Linux(CentOS) ç³»ç»Ÿ

æœ¬é¡¹ç›®æä¾›äº‘æœåŠ¡å™¨ Linux(CentOS) ç³»ç»Ÿä¸‹çš„éƒ¨ç½²æ–¹æ³•ã€‚

##### ä¸­é—´ä»¶åŠä¾èµ–ç¯å¢ƒè¦æ±‚

é™¤äº†ä¸Šæ–‡ Windows ç³»ç»Ÿæ‰€éœ€ä¾èµ–å¯¹åº”çš„ç›¸åº” Linux(CentOS) ç‰ˆæœ¬å¤–ï¼Œè¿˜éœ€è¦ä»¥ä¸‹è½¯ä»¶ï¼š

| åç§°         | ç‰ˆæœ¬                        |
| ------------ | --------------------------- |
| Apache Maven | 3.6.2 (Red Hat 3.6.2-7)     |
| jdk          | azul/zulu-openjdk-centos:19 |

- å»ºè®®ä½¿ç”¨`yum`å®‰è£…æˆ–ä½¿ç”¨ç±»ä¼¼å‰ç«¯éƒ¨ç½²ä¸­çš„`Xftp`æ–¹æ³•è¿›è¡Œä¸‹è½½ã€‚

```
#ä¾‹å¦‚yumä¸‹è½½JAVAï¼Œä¹Ÿå¯è‡ªåŠ¨å®‰è£…jdk
yum install java
#æŸ¥çœ‹javaç›¸å…³ç‰ˆæœ¬
[root@iZ0jlcwqnqznbcutd1jtirZ ~]# java --version
openjdk 19.0.2 2023-01-17
OpenJDK Runtime Environment Zulu19.32+13-CA (build 19.0.2+7)
OpenJDK 64-Bit Server VM Zulu19.32+13-CA (build 19.0.2+7, mixed mode, sharing)
```

##### éƒ¨ç½²æ­¥éª¤

- ä½¿ç”¨`Xshell`å®‰è£…ä¸Šè¿°ç‰ˆæœ¬åŠå…¶ç›¸å…³ä¾èµ–ã€‚ 

- ä½¿ç”¨`maven`å¯¼å‡ºæœ¬åœ°`spring boot`é¡¹ç›®

```cmd
#æ³¨æ„ï¼Œè‹¥æ‚¨å°†ç»ˆç«¯é»˜è®¤è®¾ç½®ä¸ºpowershllï¼Œä¸‹é¢çš„å‘½ä»¤å¯èƒ½ä¼šäº§ç”Ÿé”™è¯¯ï¼Œè¯·ä½¿ç”¨cmd
mvn install -Dmaven.test.skip=true
```

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨`IDEA`è‡ªå¸¦çš„ GUI ç•Œé¢å®Œæˆç›¸å…³æ‰“åŒ…æ“ä½œã€‚

å®Œæˆæ‰“åŒ…åç»ˆç«¯åº”è¾“å‡ºï¼š

```
[INFO] BUIDE SUCCESS
```

åœ¨é¡¹ç›®çš„`target`ç›®å½•ä¸‹ï¼Œä¼šå‡ºç°æ‰“åŒ…å¥½çš„`jar`æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š

![](.\img\12.png)

- å°†`jar`æ–‡ä»¶åŒ…ä¸Šä¼ è‡³è¿œç¨‹æœåŠ¡å™¨ã€‚

æ‚¨å¯ä»¥é‡‡ç”¨ä¸Šè¿°çš„`Xftp`æ–¹å¼ï¼Œä¹Ÿå¯ä»¥è‡ªç”±é€‰æ‹©ã€‚ä¾‹å¦‚æ‚¨å¯ä»¥ç›´æ¥åœ¨è¿œç¨‹æœåŠ¡å™¨ä½¿ç”¨`git`æ‹‰å–é¡¹ç›®å¹¶æ‰“åŒ…ï¼›æˆ–è€…é‡‡ç”¨ä¸‹æ–‡ä¼šæåˆ°çš„`github action`æ–¹æ³•ã€‚

- åœ¨è¿œç¨‹æœåŠ¡å™¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º`application.properties`æ–‡ä»¶

å°†é¡¹ç›®çš„å¯¹åº”æ–‡ä»¶å¤åˆ¶ä¸€ä»½æ”¹å…¥è¯¥æ–‡ä»¶ï¼Œè¯·ä¿®æ”¹å¯¹åº”æš´éœ²ç«¯å£ã€‚è¯·è®¾ç½®è‡ªå·±çš„`application.properties`ç›¸å…³å†…å®¹ã€‚

- ç›´æ¥è¿è¡Œé¡¹ç›®

```
java -jar LAL-0.0.1-SNAPSHOT.jar
```

ç»ˆç«¯è¾“å‡ºç±»ä¼¼`Windows`ç³»ç»Ÿä¸­ã€‚

![](.\img\13.png)

- ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹è¿è¡Œé¡¹ç›®

```
nohup java -jar -Dspring.config.location=./application.properties LAL-0.0.1-SNAPSHOT.jar &
```

é‡‡ç”¨å®ˆæŠ¤è¿›ç¨‹çš„å¥½å¤„æ˜¯å®ƒç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶ä¸”å‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–å¾ªç¯ç­‰å¾…å¤„ç†æŸäº›äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥ä¸€ç›´è¿è¡Œåœ¨äº‘æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸å—åˆ°æˆ‘ä»¬è¿œç¨‹ç»ˆç«¯ä¸­æ–­çš„å½±å“ã€‚

- æŸ¥çœ‹æ˜¯å¦è¿è¡ŒæˆåŠŸ

```
tail -f nohup.out
```

å¾—åˆ°çš„å†…å®¹å¦‚ä¸‹ï¼š

```
tokenä¸­å¾—åˆ°çš„userId:10000071
Token è¿‡æœŸæ—¶é—´: Sat Jun 03 19:33:29 CST 2023
å‰©ä½™æœ‰æ•ˆæ—¶é—´: 2608968 ms
æ”¶åˆ°å¿ƒè·³ å½“å‰æ—¶é—´:Sat Jun 03 18:50:00 CST 2023 å‰©ä½™æœ‰æ•ˆæ—¶é—´:2608967
2023-06-03T18:50:07.288+08:00  INFO 40862 --- [nio-8080-exec-2] c.e.lal.interceptors.JWTInterceptor      : tokenï¼šeyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6IjEwMDAwMDcxIiwiZXhwIjoxNjg1NzkxOTk0fQ.z6mNNv38XpuM4whwiKZJPHRwO5rPpwpUOZPqi57WH2Q
æ‹¦æˆªå™¨å¼€å§‹å·¥ä½œ
tokenä¸­å¾—åˆ°çš„userId:10000071
Token è¿‡æœŸæ—¶é—´: Sat Jun 03 19:33:14 CST 2023
å‰©ä½™æœ‰æ•ˆæ—¶é—´: 2586711 ms
æ”¶åˆ°å¿ƒè·³ å½“å‰æ—¶é—´:Sat Jun 03 18:50:07 CST 2023 å‰©ä½™æœ‰æ•ˆæ—¶é—´:2586710
```

è¯´æ˜ç¨‹åºå·²ç»æ­£å¸¸è¿è¡Œã€‚

- æµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸ

```
curl 8.130.11.33ï¼š80
```

å¦‚æœå¯ä»¥æ­£å¸¸æ¥æ”¶åˆ°ä¿¡å·è¯´æ˜éƒ¨ç½²å·²å®Œæˆã€‚



### æœ¬åœ°éƒ¨ç½²ï¼ˆDockerï¼‰

åŒæ ·ï¼Œå’Œå‰ç«¯ä¸€æ ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨`docker`è¿›è¡Œä¾¿æ·åœ°æœ¬åœ°éƒ¨ç½²ã€‚

è¿‡ç¨‹å¦‚ä¸‹ï¼š

#### æ„å»º

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å»ºç«‹`LAL-0.0.1-SNAPSHOT.jar`ã€`Dockerfile`æ–‡ä»¶ï¼Œå…¶ä¸­ï¼Œ`LAL-0.0.1-SNAPSHOT.jar`æ˜¯æ‰“åŒ…å¥½çš„é¡¹ç›®æ–‡ä»¶ï¼Œ`Dockerfile`æ˜¯`Docker`æ„å»ºæ–‡ä»¶ã€‚

- `Docker`æ‹‰å»`jdk`é•œåƒ

```
docker pull azul/zulu-openjdk-centos:19
```

- é…ç½®`Dockerfile`æ–‡ä»¶

```dockerfile
#åŸºç¡€é•œåƒä½¿ç”¨azul/zulu-openjdk-centos
FROM azul/zulu-openjdk-centos:19
# ä½œè€…ä¿¡æ¯
LABEL maintainer="WYK827906540@163.com"
# å¼€æ”¾ç«¯å£
EXPOSE 8080
# å°† LAL-0.0.1-SNAPSHOT.jar å¤åˆ¶åˆ° docker ä¸­ï¼Œå¹¶é‡å‘½åä¸º lal.jar
ADD LAL-0.0.1-SNAPSHOT.jar lal_back.jar
# å®¹å™¨æ‰§è¡Œå‘½ä»¤
RUN bash -c 'touch lal_back.jar'
ENTRYPOINT ["java", "-jar", "lal_back.jar"]
```

- æ„å»º`Docker`é•œåƒ

```
docker build -t hathoric/lal_back:v0 .
```

- ä¸Šä¼ `Docker`é•œåƒ

```
docker push hathoric/lal_back:v0
```

è‡³æ­¤ï¼Œ`Docker`é•œåƒå·²ç»æ„å»ºä¸Šä¼ å®Œæ¯•ã€‚

#### æ‹‰å»è¿è¡Œ Docker é•œåƒ

- æ‹‰å»`Docker`é•œåƒ

```
docker pull hathoric/lal_front:v0
```

- è¿è¡Œ`Docker`é•œåƒ

```
docker run -d -p 80:80 --name mynginx -d hathoric/lal_back:v0
```

- æŸ¥çœ‹è¿è¡Œæƒ…å†µ

```
docker ps
```

è‹¥ä»¥ä¸Šé•œåƒæ­£åœ¨è¿è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨æœ¬åœ°`8080`ç«¯å£è¿›è¡Œ`RESTful`æµ‹è¯•ã€‚



### è¿œç¨‹éƒ¨ç½²ï¼ˆGithub actionï¼‰

#### CD æµæ°´çº¿è®¾è®¡

æµæ°´çº¿è®¾è®¡å’Œå‰ç«¯ç±»ä¼¼ï¼Œåªæ˜¯å°†æµ‹è¯•æ–¹æ³•æ¢ä¸º`RESTful`æµ‹è¯•ï¼Œå› æ­¤åˆ«çš„å†…å®¹ä¸å†èµ˜è¿°ã€‚

è¿™é‡Œåªç»™å‡º`Github`ä»“åº“è¿æ¥ï¼š

> [BUAA-SEF-Team15/Learning_and_Living_Platform_BackEnd: BackEnd repository for Learning_and_Living_Platform (github.com)](https://github.com/BUAA-SEF-Team15/Learning_and_Living_Platform_BackEnd)

#### Github actionå®ç°

å…¶ä»–å†…å®¹å’Œå‰ç«¯ç±»ä¼¼ï¼Œè¿™é‡Œåªç»™å‡º`.yml`çš„å‚è€ƒå†™æ³•

```yml
name: Java CI

on:
  push:
    # åˆ†æ”¯
    branches: 
      - main
jobs:
  compile:
    runs-on: ubuntu-latest
    name: Running Java ${{ matrix.java }} compile
    steps:
      - name: æœåŠ¡å™¨æ‰§è¡Œ java -jar
        uses: cross-the-world/scp-pipeline@master
        with:
          command: |
            cd ~/backend/
            sudo git checkout main
            sudo git fetch --all 
            sudo git reset --hard origin/main
            sudo git pull
            sudo mvn install
            sudo mvn -B package --file pom.xml -Dmaven.test.skip=true 
            sudo fuser -k 8080/tcp
            sudo java -jar target/LAL-0.0.1-SNAPSHOT.jar &
          host: ${{ secrets.SERVER_HOST }}
          user: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
```

æˆåŠŸè§¦å‘è¿è¡Œå·¥ä½œæµå¦‚ä¸‹ï¼š

![](./img/14.png)

å…¶ä½™é…ç½®é—®é¢˜å¯ä»¥å‚è€ƒå‰ç«¯å®ç°æ–¹å¼ã€‚

- *è‡³æ­¤ï¼Œå‰åç«¯å‡å·²é…ç½®éƒ¨ç½²å®Œæ¯•ã€‚*



## Docker Dev Environment å¼€å‘ç¯å¢ƒæ„å»ºè¿è¡Œ

`Docker Dev Environment`ä¸ºæˆ‘ä»¬æä¾›äº†ä¾¿æ·å¿«é€Ÿçš„é›†æˆå¼å¼€å‘æ–¹å¼ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»æ•´ä¸ª`Docker Dev Environment`ç¯å¢ƒçš„æ„å»ºå’Œè¿è¡Œã€‚

æ¨èå°†å‰ç«¯é¡¹ç›®æ–‡ä»¶å¤¹å’Œåç«¯é¡¹ç›®æ–‡ä»¶å¤¹æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ–¹ä¾¿`Docker Dev Environment`çš„æ„å»ºã€‚

### ä¾èµ–

æ‚¨å¯ä»¥é‡‡ç”¨`Windows`ç³»ç»Ÿä¸‹çš„`Docker Desktop`å®Œæˆæ•´ä¸ªç¯å¢ƒçš„å¼€å‘æ„å»ºã€‚
æ¨è`Docker Desktop`ç‰ˆæœ¬åŠé“¾æ¥ï¼š[Download Docker Desktop | Docker](https://www.docker.com/products/docker-desktop/)

| åç§°           | ç‰ˆæœ¬   |
| -------------- | ------ |
| Docker Desktop | 4.20.0 |



### æ„å»º

- ç¼–å†™å‰ç«¯`Dockerfile`

åœ¨å‰ç«¯é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º`Dockerfile`æ–‡ä»¶ï¼Œå¡«å†™å†…å®¹å¦‚ä¸‹æ‰€ç¤º

```dockerfile
# å°†ä½ çš„å‰ç«¯çš„Dockerfileå¤åˆ¶åˆ°è¿™é‡Œ
FROM --platform=$BUILDPLATFORM node:20 AS development
WORKDIR /code
COPY package*.json /code/package*.json
# æå‰ä¸‹è½½æ‰€æœ‰ä¾èµ–é¡¹
RUN npm init -y
RUN npm cache clean --force
RUN npm install

FROM development AS dev-envs
RUN sed -i s@/deb.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list
RUN apt-get update
RUN apt-get install -y --no-install-recommends git

COPY . /code
EXPOSE 80
CMD ["npm", "run", "serve"]
```

- ç¼–å†™åç«¯`Dockerfile`

åœ¨åç«¯é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º`Dockerfile`æ–‡ä»¶ï¼Œå¡«å†™å†…å®¹å¦‚ä¸‹æ‰€ç¤º

```Dockerfile
# å°†ä½ çš„åç«¯çš„Dockerfileå¤åˆ¶åˆ°è¿™é‡Œ
FROM --platform=$BUILDPLATFORM maven:3.9.2-eclipse-temurin-17 AS development
WORKDIR /code
COPY pom.xml /code/pom.xml
# æå‰ä¸‹è½½æ‰€æœ‰ä¾èµ–é¡¹
RUN mvn dependency:go-offline

FROM development AS dev-envs
RUN sed -i s@/deb.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list
RUN apt-get update
RUN apt-get install -y --no-install-recommends git

COPY src /code/src
EXPOSE 8080
CMD ["mvn", "spring-boot:run"]
```

- åœ¨åŒ…å«å‰ç«¯é¡¹ç›®æ–‡ä»¶å¤¹å’Œåç«¯é¡¹ç›®æ–‡ä»¶å¤¹çš„æ–‡ä»¶å¤¹ä¸‹æ–°å¢`compose-dev.yaml`æ–‡ä»¶

å¡«å†™å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š

```yaml
services:
  backend:
    build:
      context: Learning_and_Living_Platform_BackEnd
      target: dev-envs
    ports:
      - 8080:8080
    restart: always
    networks:
      - vue-spring
    volumes:
      - ./Learning_and_Living_Platform_BackEnd/src:/code/src
  frontend:
    restart: always
    build:
      context: Learning_and_Living_Platform_FrontEnd
      target: dev-envs
    volumes:
      - ./Learning_and_Living_Platform_FrontEnd/src:/code/src
    ports:
      - 80:80
    networks:
      - vue-spring
networks:
  vue-spring: {}
```

- ç¼–å†™å®Œæˆåï¼Œè¿è¡Œ`Docker Desktop`

é€‰æ‹©`Dev environments`ç‚¹å‡»`create`æŒ‰é’®æ–°å»ºä¸€ä¸ªå®¹å™¨ã€‚é€‰æ‹©åŒ…å«`compose-dev.yaml`çš„æ–‡ä»¶å¤¹å¹¶ç‚¹å‡»æ„å»ºã€‚

![](.\img\15.png)

è¯¥è¿‡ç¨‹å¯èƒ½è¦æ¶ˆè€—å¤§é‡æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

- å®Œæˆåï¼Œ`Docker`ä¼šè‡ªåŠ¨è¿è¡Œè¯¥å®¹å™¨ï¼Œ`Docker Dev Environment`å·²ç»æ„å»ºå®Œæˆã€‚

![](.\img\16.png)

ä½¿ç”¨`Docker Dev Environment`çš„ä¼˜åŠ¿ï¼š

- è½»é‡å’Œå¯ç§»æ¤æ€§ï¼šDockerå®¹å™¨æ˜¯è½»é‡çº§çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸å®¿ä¸»æœºå…±äº«æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚è¿™ä½¿å¾—å®¹å™¨æ˜“äºéƒ¨ç½²å’Œè¿ç§»ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œï¼Œè€Œæ— éœ€æ‹…å¿ƒä¾èµ–é¡¹å’Œé…ç½®çš„ä¸å…¼å®¹æ€§é—®é¢˜ã€‚
- ä¸€è‡´æ€§å’Œå¯é‡å¤æ€§ï¼šé€šè¿‡ä½¿ç”¨Dockeré•œåƒï¼Œå¯ä»¥ç¡®ä¿æ¯ä¸ªå¼€å‘äººå‘˜åœ¨ç›¸åŒçš„åŸºç¡€ç¯å¢ƒä¸­å·¥ä½œï¼Œé¿å…äº†ç”±äºå¼€å‘ç¯å¢ƒå·®å¼‚å¼•èµ·çš„é—®é¢˜ã€‚é•œåƒå¯ä»¥è¢«ç‰ˆæœ¬æ§åˆ¶å’Œå…±äº«ï¼Œç¡®ä¿å›¢é˜Ÿæˆå‘˜ä¹‹é—´å¼€å‘ç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚
- ç®¡ç†ä¾èµ–å…³ç³»ï¼šä½¿ç”¨Dockerå®¹å™¨å¯ä»¥è½»æ¾ç®¡ç†åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¾èµ–é¡¹ã€‚è¯·åœ¨Dockerfileä¸­æŒ‡å®šå’Œå®‰è£…ç‰¹å®šç‰ˆæœ¬çš„è½¯ä»¶åŒ…å’Œåº“ï¼Œç¡®ä¿å¼€å‘ç¯å¢ƒä¸­çš„ä¾èµ–å…³ç³»æ­£ç¡®ä¸”ä¸€è‡´ã€‚è¿™æ¶ˆé™¤äº†æ‰‹åŠ¨è®¾ç½®å’Œç®¡ç†ä¾èµ–é¡¹çš„éœ€è¦ã€‚
- éš”ç¦»æ€§å’Œå®‰å…¨æ€§ï¼šæ¯ä¸ªDockerå®¹å™¨éƒ½æ˜¯éš”ç¦»çš„ï¼Œå…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹å’Œç½‘ç»œç©ºé—´ã€‚è¿™æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ï¼Œå› ä¸ºå®¹å™¨ä¹‹é—´çš„ç›¸äº’å½±å“è¢«é™åˆ¶åœ¨å®¹å™¨å†…éƒ¨ã€‚å¦‚æœä¸€ä¸ªå®¹å™¨å—åˆ°æ”»å‡»æˆ–å‡ºç°é—®é¢˜ï¼Œå…¶ä»–å®¹å™¨å’Œå®¿ä¸»æœºé€šå¸¸ä¸ä¼šå—åˆ°å½±å“ã€‚
- å¯æ‰©å±•æ€§å’Œå¼¹æ€§ï¼šDockerå®¹å™¨å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œæ‰©å±•å’Œå¤åˆ¶ï¼Œä»¥é€‚åº”ä¸åŒçš„è´Ÿè½½ã€‚Dockeræ¥ç®¡ç†å’Œè‡ªåŠ¨åŒ–å®¹å™¨çš„æ‰©å±•å’Œéƒ¨ç½²ï¼Œä»¥å®ç°å¼¹æ€§å’Œé«˜å¯ç”¨æ€§ã€‚
- ç®€åŒ–éƒ¨ç½²å’Œå‡çº§ï¼šä½¿ç”¨Dockerå®¹å™¨ï¼Œæ‚¨å¯ä»¥æ›´è½»æ¾åœ°éƒ¨ç½²å’Œæ›´æ–°åº”ç”¨ç¨‹åºã€‚é€šè¿‡å°†åº”ç”¨ç¨‹åºå’Œå…¶ä¾èµ–é¡¹æ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œå¯ä»¥é¿å…åœ¨ç›®æ ‡ç¯å¢ƒä¸­æ‰‹åŠ¨è®¾ç½®å’Œé…ç½®æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œç®€åŒ–äº†éƒ¨ç½²è¿‡ç¨‹ã€‚è€Œä¸”ï¼Œå¦‚æœéœ€è¦å‡çº§åº”ç”¨ç¨‹åºæˆ–å…¶ä¾èµ–é¡¹ï¼Œåªéœ€æ„å»ºæ–°çš„é•œåƒå¹¶æ›¿æ¢æ—§çš„å®¹å™¨å³å¯ã€‚



## å¸¸è§é—®é¢˜

1ï¼‰å»ºè®®æ‚¨åœ¨æé—®å‰ä»”ç»†é˜…è¯»æœ¬æ–‡ä»¶å’Œç›¸å…³å®˜æ–¹æ–‡æ¡£ï¼Œå¹¶ä¸”åœ¨ç›¸å…³çš„æ ‡é¢˜ä¸‹æŸ¥æ‰¾æ˜¯å¦æœ‰å®ç°æ‚¨éœ€è¦åŠŸèƒ½çš„é…ç½®é¡¹ï¼›

2ï¼‰æŸ¥çœ‹æœ¬é¡¹ç›®çš„`Github`ä»“åº“ï¼›

3ï¼‰å»ºè®®åœ¨é¡¹ç›®ä¸­å¤ç°æ‚¨çš„é—®é¢˜å¹¶å‘æˆ‘ä»¬æé—®ã€‚

4ï¼‰è”ç³»æˆ‘ä»¬ï¼š[BUAA-SEF-Team15 (github.com)](https://github.com/BUAA-SEF-Team15)



## è‡´è°¢

åœ¨æ­¤æ„Ÿè°¢è¯¾ç¨‹ç»„å’ŒåŠ©æ•™ä»¬å¯¹æˆ‘ä»¬çš„å¸®åŠ©ï¼Œæ„Ÿè°¢å„ä½ç»„å‘˜çš„ç›¸å…³å·¥ä½œä¸ä»˜å‡ºï¼
